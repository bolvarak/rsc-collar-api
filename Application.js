///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'use strict'; /// Strict Syntax //////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
require('./Prototype/Array'); /// Array Prototypes ///////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
require('./Prototype/String'); /// String Prototypes /////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
const $config = require('./Common/Configuration'); /// Configuration Module //////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Module Dependencies //////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// We need the path module
let $path = require('path');
// We need the logging module
let $logger = require('morgan');

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Express Dependencies /////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// We need the Express module
let $express = require('express');
// We need the Express POST parser module
let $expressBodyParser = require('body-parser');
// We need cookie support
let $expressCookieParser = require('cookie-parser');

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Application Definition ///////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

let $application = $express();

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// View Engine Definition & Setup ///////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// Set the path to the views into the application
$application.set('views', $path.join(__dirname, 'Block'));
// Load our proper engine
$application.engine('ejs', require('ejs-locals'));
// Set the view engine into the application
$application.set('view engine', 'ejs');

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Logging Middleware ///////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// Set our logger into the application
$application.use($logger('rsc-collar-api'));

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Application Middleware ///////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// We need to parse JSON POST data
$application.use($expressBodyParser.json());
// We need to parse GET variables
$application.use($expressBodyParser.urlencoded({
	'extended': true
}));
// We need to parse cookies
$application.use($expressCookieParser());
// Define our static path
$application.use($express.static($path.join(__dirname, 'UI')));

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Custom Middleware ////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// We need some custom functionality added to our response object
$application.use(require('./Middleware/Response'));
// We need some custom functionality added to our request object
$application.use(require('./Middleware/Request'));
// We need authentication
$application.use(require('./Middleware/Authentication'));

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Routes ///////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// Load the admin routes
$application.use(require('./Endpoint/Collar/Index'));

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// 404 - Not Found Handler //////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

$application.use(require('./Middleware/NotFound'));

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// 500/Error Handler ////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

$application.use(require('./Middleware/InternalServerError'));

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
module.exports = $application; /// Application Export ////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

